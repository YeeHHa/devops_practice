// Testing out some pipeline stuff

pipeline{
	agent none

	environment{
		withCredentials([string(credentialsId: 'sonar_project_key', variable: 'sonar_key_value')]) {
    		sonarKey = sonar_key_value
		}
		
	}

	stages{
		
		stage('setup'){
			agent any
			steps{
				script{
					env.MINOR_VERSION = sh(returnStdout: true, script: "git rev-list --all --count").trim()
					currentBuild.setDisplayName("${env.MINOR_VERSION}")
					echo "${env.MINOR_VERSION}"
				}
			}
		}

		stage('dockerize'){
			agent{
				docker{
					image 'sonarsource/sonar-scanner-cli'
				}
			}
			steps{
				script{
					sh '''
						pwd
						sonar-scanner \
						-Dsonar.organization=yeeha \
						-Dsonar.projectKey=${sonarKey} \
						-Dsonar.sources=. \
						-Dsonar.host.url=https://sonarcloud.io
					'''
				}
			}
		}

		// stage('test 3'){
		// 	agent{
		// 		docker{
		// 			image 'docker:latest'
		// 		}
		// 	}	
			
		// 	steps{
		// 		script{
		// 			sh "docker images"
		// 		}
		// 	}
		// }
	}
}