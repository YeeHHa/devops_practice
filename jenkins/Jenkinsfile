// Testing out some pipeline stuff

pipeline{
	agent none

	environment{
		sonarKey = credentials('sonar_project_key')
		sonarToken = credentials('sonar_token_1')
		
	}

	stages{
		
		stage('setup'){
			agent any
			steps{
				script{
					env.MINOR_VERSION = sh(returnStdout: true, script: "git rev-list --all --count").trim()
					currentBuild.setDisplayName("${env.MINOR_VERSION}")
					echo "${env.MINOR_VERSION}"
				}
			}
		}

		stage('dockerize'){
			agent{
				docker{
					image 'sonarsource/sonar-scanner-cli:latest'
					args ' -v $WORKSPACE/sonar_cache:/opt/sonar-scanner/.sonar/cache'
					
					
				}
			}
			steps{
				script{
					
					
					
					sh '''
						
						pwd
						
						echo ${UID}
						sonar-scanner \
						-Dsonar.organization=yeehha \
						-Dsonar.projectKey=${sonarKey} \
						-Dsonar.sources=. \
						-Dsonar.host.url=https://sonarcloud.io \
						-Dsonar.login=${sonarToken} \
						-Dsonar.verbose=true

					'''
				}
			}
		}

		// stage('test 3'){
		// 	agent{
		// 		docker{
		// 			image 'docker:latest'
		// 		}
		// 	}	
			
		// 	steps{
		// 		script{
		// 			sh "docker images"
		// 		}
		// 	}
		// }
	}
}